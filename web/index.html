{% set title = "Devices" %} {% include wrapper/head.html %}
{% from smarter.SmarterProtocol import * %}

<script type="text/javascript" language="javascript" charset="utf-8">

var wait_update = 1000;
var wait_joke   = 60000;

// auto joke timer is not synchronized with the click event (wow that's some sufisasactating... stuff
function process_joke(joke)     { $('#quote').html( joke.question + '<br>' + joke.answer ); }
function joke()                 { $.getJSON( '/api/joke', process_joke); }
function auto_joke()            { joke(); setTimeout(auto_joke, wait_joke);}

function process_update_kettle(status) { if ( status.default.temperature.prefered == 'Celsius' ) {
                                    $('#temperature').html( status.sensors.temperature.celsius + " ºC" ); }
                                  else
                                    $('#temperature').html( status.sensors.temperature.fahrenheid + " ºF" );
                                  $('#water').html( status.sensors.water.level-status.sensors.water.base );
                                }


    
function update_kettle(ip)             { $.getJSON( '/api/' + ip + '/status', process_update_kettle); }
function auto_update_kettle(ip)        { update_kettle(ip); setTimeout(auto_update_kettle, wait_update, ip); }


function process_update_coffee(status) { }

function update_cofee(ip)             { $.getJSON( '/api/' + ip + '/status', process_update_cofee); }
function auto_update_coffee(ip)        { update_cofee(ip); setTimeout(auto_update_cofee, wait_update, ip); }




function calibrate(ip)          { $.getJSON( '/api/' + ip + '/calibrate'); }
function start(ip)              { $.getJSON( '/api/' + ip + '/start'); }
function stop(ip)               { $.getJSON( '/api/' + ip + '/stop'); }

$(document).ready(              function() { setTimeout(auto_joke, wait_joke);
                                {% for ip in clients %}
                                {% if clients[ip].isKettle %}
                                    setTimeout(auto_update_kettle, wait_update, '{{ ip }}');
                                {% elif clients[ip].isCoffee %}
                                    setTimeout(auto_update_coffee, wait_update, '{{ ip }}');
                                {% end %}
                                {% end %}
                                }
                 );

</script>




<a href="javascript:joke()">
<div id="quote">
'{{ escape(joke[0]) }}...'<br>...{{ escape(joke[1]) }}
</div>
</a>

<div align="center">
{% for ip in clients %}

{% if clients[ip].isCoffee %}
<img src="{{ static_url('icons/coffee/coffee.png')}}"><br>
{% end %}
{% if clients[ip].isKettle %}
{% if clients[ip].onBase %}
<img id="devices" src="{{ static_url('icons/kettle/kettle.png')}}"><br>
<a href="javascript:calibrate('{{ ip }}')"><img height="24px" src="{{ static_url('icons/commands/calibrate.png') }}"></a>
{% else %}
<img  id="devices" src="{{ static_url('icons/kettle/offbase.png')}}">
{% end %}
<a href="javascript:stop('{{ ip }}')"><img height="24px" src="{{ static_url('icons/commands/stop.png') }}"></a>
<a href="javascript:start('{{ ip }}')"><img height="24px" src="{{ static_url('icons/commands/start.png') }}"></a>
<a href="/wifi"><img height="24px" src="{{ static_url('icons/commands/wifi.png') }}"></a>
<a href="/settings"><img height="24px" src="{{ static_url('icons/commands/settings.png') }}"></a>
{% end %}

<br>
{% if clients[ip].isKettle %}
{% if clients[ip].onBase %}
{% if clients[ip].temperature < 33 %}
<img height="24px" src="{{ static_url('icons/kettle/temperature/low.png')}}">
{% elif clients[ip].temperature < 66 %}
<img height="24px" src="{{ static_url('icons/kettle/temperature/middle.png')}}">
{% else %}
<img height="24px" src="{{ static_url('icons/kettle/temperature/high.png')}}">
{% end %}
<span id="temperature">{{ Smarter.temperature_to_string(clients[ip].temperature) }}</span>
<img height="24px" src="{{ static_url('icons/kettle/water/water.png')}}">
<span id="water">{{ str(clients[ip].waterSensor - clients[ip].waterSensorBase) }}</span>
{% else %}
{% end %}
{% end %}


{% end %}
</div>

{% include wrapper/foot.html %}

