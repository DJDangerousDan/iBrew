Smarter iKettle & Smarter Coffee protocol description
GENERATED by iBrew (command: iBrew protocol)
https://github.com/Tristan79/iBrew
Mon Aug  8 16:01:27 CEST 2016

  Smarter iKettle 2.0 & Smarter Coffee Protocol Structure
  _______________________________________________________

  Smarter uses a binary message protocol,
  either via UDP or TCP on port 2081

  Messages (commands and responses) use the syntax:

    <ID>[ARGUMENTS]<TAIL>

  The tail is always 7e or ~ in ASCII

  Arguments use this syntax:

    <ARGUMENT>   is a single mandatory byte
    <[ARGUMENT]> is a single optional byte
    <ARGUMENT>{0,32} is mandatory, between 0 and 32 bytes

  Everything else, including spurious } characters, are ASCII literals

  Is connected locally it will send a command response message
  as reply to a command before any other response message

192.168.4.1

  k c ID Command Message
  ___________________________________________
  ✓ ? 02 Set device time
  ✓ ? 05 Set WiFi network SSID
  ✓ ? 07 Set WiFi network password
  ✓ ? 0c Connect to WiFi network
  ✓ ? 0d Scan for WiFi networks
  ✓ ? 0f Reset Wifi networks
  ✓ ? 10 Working unknown command (reset?)
  ✓ ? 15 Heat kettle
  ✓ ? 16 Stop heating kettle
  ✓ ? 19 Heat kettle using formula mode
  ✓ ? 1f Set Default Values
  ✓ ? 20 Working unknown command (turn on?)
  ✓ ? 21 Working unknown command (turn on?)
  ✓ ? 22 Working unknown command (turn on?)
  ✓ ? 23 Working unknown command (turn on?)
  ✓ ? 28 Working unknown command
  ✓ ? 2a Set water sensor base value
  ✓ ? 2b Get water sensor base value
  ✓ ? 2c Calibrate water sensor
  ✓ ? 30 Working unknown command
  ✕ ✓ 32 Working unknown command
  ✕ ✓ 33 Start coffee brewing
  ✕ ✓ 35 Set strength of the coffee to brew
  ✕ ✓ 36 Set number of cups to brew
  ✕ ✓ 37 Start coffee brewing using default
  ✕ ✓ 3c Toggle grinder
  ✕ ✓ 3e Turn on hotplate
  ✕ ✓ 40 Working unknown command (schedule?)
  ✕ ✓ 41 Working unknown command (schedule?)
  ✕ ✓ 43 Working unknown command (schedule?)
  ✕ ✓ 4a Turn off hotplate
  ✓ ✓ 64 Get identify of device
  ✓ ? 69 Working unknown command
  ✓ ? 6a Get WiFi firmware info
  ✓ ? 6d Firmware upgrade

  k c ID Response Message
  _______________________________
  ✓ ✓ 03 Command status
  ✓ ? 0e List of WiFi networks
  ✓ ✓ 14 Device status
  ✓ ? 29 Working unknown reply
  ✓ ? 2d Water sensor base value
  ✓ ✓ 65 Identify of device
  ✓ ? 6b WiFi firmware info

  Legend:
    k iKettle 2
    c Smarter Coffee


  Command Message: 02 Set device time
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Arguments: <Seconds><Minutes><Hours><Unknown><Day><Month><Century><Year>
  Note: Unknown is Day of week index?


  Response Message: 03 Command status
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ✓ SmarterCoffee

d


  Command Message: 05 Set WiFi network SSID
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Argument: <SSID>{0,32}
  Note: SSID is between 0 and 32 characters

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Command Message: 07 Set WiFi network password
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Argument: <password>{0,32}
  Note: password is between 0 and 32 characters

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Command Message: 0c Connect to WiFi network
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  No information available on message

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Command Message: 0d Scan for WiFi networks
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Response Message: 0e List of WiFi networks

  Example raw code: 0d 7e

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Response Message: 0e List of WiFi networks
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Command Message: 0d Scan for WiFi networks

  Arguments: <SSID>{0,32},-<db>{2}}
  Note: SSID is between 0 and 32 characters
        Sending message 0c without previous SSID/password messages will reset WiFi to factory settings
        -db is the signal strength in dBm format

  Examples: MyWifi,-56}
            MyWifi,-56}OtherWifi,-82}

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Command Message: 0f Reset Wifi networks
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Returns: Message 0f

  Example raw code: 0f 7e


  Command Message: 10 Working unknown command (reset?)
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  No information available on message


  Response Message: 14 Device status
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ✓ SmarterCoffee

  Arguments: <status><temperature><waterHighbits><waterLowbits><unknown>

  Calibration:

      If the kettle is on the base during calibration, the numbers change to be higher,
      but the differences between levels seem the same. This means that the water level
      detection is probably weight based and that calibration is done at the base,
      which then remembers the weight for 'off base'. To detect an empty kettle,
      the connecting device must account for the weight of the kettle itself.


  Command Message: 15 Heat kettle
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Argument: <temperature><keepwarm>
  15 32 00 7e start boiling
  15 32
  temperature 00..64
  keepwarm not 00, minutes: 05..1e
  Example raw code: 15 ?? 7e
  if it's warming you have to send an off command to boil again
  if it's not on temp it boils first before warming...


  Command Message: 16 Stop heating kettle
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Example raw code: 16 7e


  Command Message: 19 Heat kettle using formula mode
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Arguments: <formulatemperature><keepwarmtime>

  Example raw code: 19 32 19 7e
  Boil water to (default user temperature)
 and cool until 50'C (32) with keep warm time of 25 minutes (19)


  Command Message: 1f Set Default Values
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Arguments <keep warm time><defaulttemp><formula><formulatemp>

  Example raw code: 1f 19 64 01 22 7e
  sets 25 keep warm, 100 default temperature, formula mode = true
  34 formula temperature

  default user defaults are 1f 00 64 00 4b 7e 


  Command Message: 20 Working unknown command (turn on?)
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Example raw code: 20 7e


  Command Message: 21 Working unknown command (turn on?)
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Arguments: <[<temperature><[time]>]>

  Keep Warm between 5 and 20 minutes, 0 for normal on

  Example raw code: 21 7e
                  21 50 00 7e
                  21 30 05 7e
                  21 44 7e


  Command Message: 22 Working unknown command (turn on?)
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Example raw code: 22 7e


  Command Message: 23 Working unknown command (turn on?)
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Example raw code: 23 7e


  Command Message: 28 Working unknown command
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Response Message: 29 Working unknown reply

  No information available on message


  Response Message: 29 Working unknown reply
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Command Message: 28 Working unknown command

  29 00 7e
  29 08 01 5f .. .. xx 7e
  29 01 01 5f 00 00 10 00 19 00 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 7d 7e

  No information available on message


  Command Message: 2a Set water sensor base value
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Arguments: <unkownArgument><unkownArgument>
  No information available on message


  Command Message: 2b Get water sensor base value
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Response Message: 2d Water sensor base value

  No information available on message 2b


  Command Message: 2c Calibrate water sensor
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Response Message: 2d Water sensor base value

  Example raw code: 2c 7e

  Calibration:

      If the kettle is on the base during calibration, the numbers change to be higher,
      but the differences between levels seem the same. This means that the water level
      detection is probably weight based and that calibration is done at the base,
      which then remembers the weight for 'off base'. To detect an empty kettle,
      the connecting device must account for the weight of the kettle itself.


  Response Message: 2d Water sensor base value
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Command Message: 2b Get water sensor base value
                   2c Calibrate water sensor

  Arguments: <unkownArgument><unkownArgument>

  Example raw code: 2c ?? ?? 7e

  Calibration:

      If the kettle is on the base during calibration, the numbers change to be higher,
      but the differences between levels seem the same. This means that the water level
      detection is probably weight based and that calibration is done at the base,
      which then remembers the weight for 'off base'. To detect an empty kettle,
      the connecting device must account for the weight of the kettle itself.


  Command Message: 30 Working unknown command
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee




  Command Message: 32 Working unknown command
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  No information available on message 32


  Command Message: 33 Start coffee brewing
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  No information available on message 33


  Command Message: 35 Set strength of the coffee to brew
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Argument: <strength>

  strength:
  00 Weak
  01 Medium
  02 Strong

  Example code: 35 01 7e

  Coffee Brewing:

      Between setting the number of cups, the strength of the coffee and start of brewing
      atleast 500ms is recommended.


  Command Message: 36 Set number of cups to brew
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Argument: <numberOfCups>
  Note: numberOfCups must be between 1 and 12

  Example code: 36 03 7e

  Coffee Brewing:

      Between setting the number of cups, the strength of the coffee and start of brewing
      atleast 500ms is recommended.


  Command Message: 37 Start coffee brewing using default
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Example 37 7e start brewing


  Command Message: 3c Toggle grinder
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Example raw code: 3c 7e


  Command Message: 3e Turn on hotplate
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Argument: <numberOfMinutes>
  Note: valid values are 5 to 30 (30 not sure)

  unknownArgument:
  05 Default

  Example raw code: 3e 05 7e


  Command Message: 40 Working unknown command (schedule?)
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Message 40: Updating schedules ???
  No information available on message


  Command Message: 41 Working unknown command (schedule?)
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Message 41: Requesting schedules ???
  No information available on message


  Command Message: 43 Working unknown command (schedule?)
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Message 43: schedules ???
  No information available on message


  Command Message: 4a Turn off hotplate
  ─────────────────────────────────────────────────────────────────────────
  ✕ iKettle 2.0  ✓ SmarterCoffee

  Example raw code: 4a 7e


  Command Message: 64 Get identify of device
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ✓ SmarterCoffee

  Response Message: 65 Identify of device

  Note: Is used for auto discovery over UDP broadcast (after device setup is complete)
        This fails on some/most routers, which don't propagate UDP broadcasts

  Example raw code: 64 7e


  Response Message: 65 Identify of device
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ✓ SmarterCoffee

  Command Message: 64 Get identify of device

  Arguments: <deviceType> <sdkVersion>

  deviceType:
  01 iKettle 2.0
  02 iSmarter Coffee

  sdkVersion:
  13 Firmware v19 (?)

  Example raw code: 65 01 13 7e


  Command Message: 69 Working unknown command
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  returns with 0 arguments 03 04 7e
  returns with 1+ argument 03 00 7e


  Command Message: 6a Get WiFi firmware info
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Response Message: 6b WiFi firmware info

  Example raw code: 6a 7e

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Response Message: 6b WiFi firmware info
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Command Message: 6a Get WiFi firmware info

  Note: iKettle 2.0 returns:
        AT+GMRAT version:0.40.0.0(Aug  8 2015 14:45:58)SDK version:1.3.0compile time:Aug  8 2015 17:19:38OK

  WiFi:

      If the device is configured to access an WiFi access point which is not available
      It will try to connect to it every so minutes. If it tries to connect it beeps three
      times the WiFi access point of the device will remain active but unreachable,
      if it fails to access the access point it beeps once, and it opens up its own default
      open unencrypted WiFi access point


  Command Message: 6d Firmware upgrade
  ─────────────────────────────────────────────────────────────────────────
  ✓ iKettle 2.0  ? SmarterCoffee

  Note: Disables wifi and creates a 'iKettle Update' network
        a hard device reset (hold power button for 10 seconds) required to fix
        opens up a port at 6000

  Example raw code: 6d 7e

